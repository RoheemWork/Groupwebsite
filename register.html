<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register - DripCase</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Navbar -->
  <header class="navbar">
    <div class="left"></div>
    <div class="center">
      <a href="index.html"><img src="assets/logo.png" alt="DripCase Logo" class="logo" /></a>
    </div>
    <div class="right"></div>
  </header>

  <main class="auth-page">
    <div class="auth-container">
      <div class="logo-container">
        <img src="assets/logo.png" alt="DripCase Logo" class="logo" />
      </div>
      
      <h2>Create Your Account</h2>
      
      <form id="registrationForm">
        <div class="form-row">
          <input type="text" id="firstName" placeholder="First Name" required>
          <input type="text" id="lastName" placeholder="Last Name" required>
        </div>
        
        <input type="date" id="dob" required>
        <select id="gender" required>
          <option value="">Select Gender</option>
          <option>Male</option>
          <option>Female</option>
          <option>Other</option>
        </select>
        
        <input type="tel" id="phone" placeholder="Phone Number" required>
        <input type="email" id="email" placeholder="Email" required>
        <input type="text" id="trn" placeholder="TRN (000-000-000)" required>
        <input type="password" id="password" placeholder="Password (min 8 chars)" required>

        <button type="button" class="submit-btn" id="registerBtn">Register</button>
      </form>
      
      <div class="auth-links">
        <p>Already have an account? <a href="login.html" class="link">Login here</a></p>
      </div>
      
      <p id="regError" class="error-message"></p>
    </div>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-bottom">
      <p>&copy; 2023 DripCase. All rights reserved.</p>
    </div>
  </footer>

  <!-- =================================================================== -->
  <!-- JAVASCRIPT FOR register.html -->
  <!-- =================================================================== -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {

      // --- UTILITY FUNCTIONS ---
      function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        notification.style.cssText = `
          position: fixed; bottom: 20px; right: 20px; padding: 15px 25px; border-radius: 5px;
          color: white; z-index: 10000; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
          background-color: ${type === 'success' ? '#4CAF50' : '#F44336'};
          animation: slideInRight 0.5s, fadeOut 0.5s 2.5s forwards;
        `;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
      }

      // --- ADMIN USER MANAGEMENT ---
      function ensureAdminExists() {
        let registrationData = JSON.parse(localStorage.getItem('RegistrationData')) || [];
        const adminTrn = '000-000-000';
        let adminUser = registrationData.find(user => user.trn === adminTrn);

        if (!adminUser) {
          adminUser = {
            name: 'Site Administrator',
            trn: adminTrn,
            password: 'admin123',
            isAdmin: true
          };
          registrationData.push(adminUser);
          console.log('Admin user created.');
        } else if (!adminUser.isAdmin) {
          adminUser.isAdmin = true;
          adminUser.password = 'admin123';
          console.log('Existing admin user repaired.');
        }

        localStorage.setItem('RegistrationData', JSON.stringify(registrationData));
      }

      // --- INITIALIZATION ---
      ensureAdminExists();

      // --- REGISTRATION LOGIC ---
      const registrationForm = document.getElementById('registrationForm');
      if (registrationForm) {
        document.getElementById('registerBtn').addEventListener('click', () => {
          const firstName = document.getElementById('firstName').value.trim();
          const lastName = document.getElementById('lastName').value.trim();
          const dob = document.getElementById('dob').value;
          const gender = document.getElementById('gender').value;
          const phone = document.getElementById('phone').value.trim();
          const email = document.getElementById('email').value.trim();
          const trn = document.getElementById('trn').value.trim();
          const password = document.getElementById('password').value;
          const regError = document.getElementById('regError');
          
          // --- FORM VALIDATION ---
          if (!firstName || !lastName || !dob || !gender || !phone || !email || !trn || !password) {
            regError.textContent = "Please fill out all fields.";
            regError.style.display = 'block';
            return;
          }
          if (password.length < 8) {
            regError.textContent = "Password must be at least 8 characters.";
            regError.style.display = 'block';
            return;
          }
          
          let registrationData = JSON.parse(localStorage.getItem('RegistrationData')) || [];
          if (registrationData.some(user => user.trn === trn)) {
            regError.textContent = "An account with this TRN already exists.";
            regError.style.display = 'block';
            return;
          }
          
          // --- SAVE USER DATA ---
          const user = { name: `${firstName} ${lastName}`, firstName, lastName, dob, gender, phone, email, trn, password, invoices: [] };
          registrationData.push(user);
          localStorage.setItem("RegistrationData", JSON.stringify(registrationData));
          
          sessionStorage.setItem('currentUserTrn', trn);
          
          showNotification("Registration successful! Redirecting...");
          setTimeout(() => window.location.href = 'index.html', 1500);
        });
      }
    });
  </script>
</body>
</html>
