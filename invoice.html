<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Invoice - DripCase</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Navbar -->
  <header class="navbar">
    <div class="left">
      <a href="index.html" class="back-to-home-link">‚Üê Back to Home</a>
    </div>
    <div class="center">
      <a href="index.html"><img src="assets/logo.png" alt="DripCase Logo" class="logo" /></a>
    </div>
    <div class="right"></div>
  </header>

  <main class="invoice-main">
    <div class="invoice-container">
      <div class="invoice-header">
        <h1>Invoice</h1>
        <div class="invoice-company-details">
          <h2 id="invoiceCompany">DripCase</h2>
          <p>Stylish protection for your devices.</p>
        </div>
        <div class="invoice-meta">
          <p><strong>Invoice Number:</strong> <span id="invoiceNumber"></span></p>
          <p><strong>Date:</strong> <span id="invoiceDate"></span></p>
        </div>
      </div>

      <hr>

      <div class="invoice-body">
        <div class="billing-info">
          <h3>Bill To:</h3>
          <p id="invoiceCustomerName"></p>
          <p id="invoiceCustomerAddress"></p>
          <p><strong>TRN:</strong> <span id="invoiceTrn"></span></p>
        </div>

        <table id="invoiceItemsTable">
          <thead>
            <tr>
              <th>Item</th>
              <th>Quantity</th>
              <th>Price</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <div class="invoice-totals">
          <p>Subtotal: <span id="invoiceSubtotal"></span></p>
          <p>Tax (15%): <span id="invoiceTax"></span></p>
          <p class="total-cost">Total: <span id="invoiceTotal"></span></p>
        </div>
      </div>
      
      <div class="invoice-footer">
        <p>Thank you for your business!</p>
        <p class="email-notification">A copy of this invoice has been sent to your email.</p>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-bottom">
      <p>&copy; 2023 DripCase. All rights reserved.</p>
    </div>
  </footer>

  <!-- =================================================================== -->
  <!-- JAVASCRIPT FOR invoice.html -->
  <!-- =================================================================== -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {

      // --- UTILITY FUNCTIONS ---
      function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        notification.style.cssText = `
          position: fixed; bottom: 20px; right: 20px; padding: 15px 25px; border-radius: 5px;
          color: white; z-index: 10000; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
          background-color: ${type === 'success' ? '#4CAF50' : '#F44336'};
          animation: slideInRight 0.5s, fadeOut 0.5s 2.5s forwards;
        `;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
      }

      // --- INVOICE PAGE LOGIC ---
      const invoice = JSON.parse(sessionStorage.getItem('currentInvoice'));

      // A security check to prevent direct access to the invoice page.
      if (!invoice) {
        showNotification("No invoice found. Redirecting to home.", 'error');
        setTimeout(() => window.location.href = 'index.html', 1500);
        return;
      }

      // Populate the page with the invoice data.
      document.getElementById('invoiceCompany').textContent = invoice.company;
      document.getElementById('invoiceNumber').textContent = invoice.invoiceNumber;
      document.getElementById('invoiceDate').textContent = invoice.date;
      document.getElementById('invoiceCustomerName').textContent = invoice.shippingInfo.fullName;
      document.getElementById('invoiceCustomerAddress').textContent = invoice.shippingInfo.address.replace(/\n/g, '<br>');
      document.getElementById('invoiceTrn').textContent = invoice.trn;

      // Dynamically create the table rows for each item in the invoice.
      const invoiceItemsTableBody = document.querySelector('#invoiceItemsTable tbody');
      invoice.items.forEach(item => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.quantity}</td>
          <td>$${item.price.toFixed(2)}</td>
          <td>$${item.total.toFixed(2)}</td>
        `;
        invoiceItemsTableBody.appendChild(row);
      });

      // Populate the total costs.
      document.getElementById('invoiceSubtotal').textContent = `$${invoice.subtotal.toFixed(2)}`;
      document.getElementById('invoiceTax').textContent = `$${invoice.tax.toFixed(2)}`;
      document.getElementById('invoiceTotal').textContent = `$${invoice.total.toFixed(2)}`;

      // Clean up the session storage so the invoice can't be viewed again.
      sessionStorage.removeItem('currentInvoice');
    });
  </script>
</body>
</html>
